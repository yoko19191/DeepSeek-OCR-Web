# 文件预览框放大/缩小功能说明

## ✨ 新增功能

在右侧文件预览框的右上角添加了**放大/缩小按钮**，支持动态调整预览区域大小，无论是否上传文档均可使用。

---

## 🎯 功能特性

### 1️⃣ **放大按钮** (Maximize2)
- **位置**：文件预览框右上角
- **图标**：两个向外箭头（展开图标）
- **鼠标悬停效果**：按钮背景变浅，图标变为青色
- **功能**：点击后放大预览区域

### 2️⃣ **缩小按钮** (Minimize2)
- **位置**：文件预览框右上角（放大后显示）
- **图标**：两个向内箭头（收缩图标）
- **鼠标悬停效果**：按钮背景变浅，图标变为青色
- **功能**：点击后恢复原始布局

---

## 📐 布局变化

### 正常模式（未放大）
```
┌────────────────────────────────────┐
│      右上方区域 (280px 高度)        │
├────────────────┬───────────────────┤
│  提示词输入框   │   文件浏览器       │
│  + 开始解析按钮 │                   │
└────────────────┴───────────────────┘
┌────────────────────────────────────┐
│      文件预览框 (自适应高度)        │ ← 放大按钮在这里
│                                    │
└────────────────────────────────────┘
```

### 放大模式（已展开）
```
┌────────────────────────────────────┐
│      右上方区域 (120px 高度)        │ ← 高度缩小
├────────────────┬───────────────────┤
│  提示词输入框   │   文件浏览器       │
│  (紧凑模式)     │                   │
└────────────────┴───────────────────┘
┌────────────────────────────────────┐
│                                    │
│      文件预览框 (放大状态)          │ ← 占据更多空间
│                                    │ ← 缩小按钮在这里
│      和左侧上传框一样高             │
│                                    │
└────────────────────────────────────┘
```

---

## 🔧 技术实现

### 1. 状态管理 (`App.tsx`)

```typescript
// 添加展开状态
const [isPreviewExpanded, setIsPreviewExpanded] = useState(false);

// 动态调整高度
<div className={`flex gap-4 flex-shrink-0 transition-all duration-300 ${
  isPreviewExpanded ? 'h-[120px]' : 'h-[280px]'
}`}>
```

**布局高度变化**：
- **正常模式**：`h-[280px]`（280 像素）
- **放大模式**：`h-[120px]`（120 像素）
- **动画效果**：`transition-all duration-300`（300 毫秒平滑过渡）

---

### 2. 提示词输入框紧凑模式 (`PromptInput.tsx`)

```typescript
interface PromptInputProps {
  // ... 其他属性
  isCompact?: boolean; // 新增紧凑模式
}

// 根据 isCompact 调整样式
<Textarea
  className={`... ${isCompact ? 'min-h-[40px]' : 'min-h-[100px]'}`}
/>

// 放大模式下隐藏"开始解析"按钮
{!isCompact && (
  <Button>开始解析</Button>
)}
```

**变化对比**：
| 模式 | Textarea 高度 | 开始解析按钮 |
|------|--------------|-------------|
| 正常 | `min-h-[100px]` | ✅ 显示 |
| 紧凑 | `min-h-[40px]` | ❌ 隐藏 |

---

### 3. 文件预览框按钮 (`FilePreview.tsx`)

```typescript
interface FilePreviewProps {
  file: FileNode | null;
  isExpanded?: boolean;        // 是否展开
  onToggleExpand?: () => void; // 切换回调
}

// 标题栏添加放大/缩小按钮
<div className="... flex items-center justify-between relative">
  <h3>{file?.name || '文件预览'}</h3>
  {onToggleExpand && (
    <Button
      onClick={onToggleExpand}
      variant="ghost"
      size="sm"
      className="h-8 w-8 p-0 hover:bg-white/50 hover:text-teal-600 ..."
      title={isExpanded ? '缩小预览' : '放大预览'}
    >
      {isExpanded ? <Minimize2 /> : <Maximize2 />}
    </Button>
  )}
</div>
```

**按钮样式**：
- `variant="ghost"`：透明背景
- `size="sm"`：小尺寸
- `h-8 w-8 p-0`：正方形按钮（32x32px）
- `hover:bg-white/50`：悬停时半透明白色背景
- `hover:text-teal-600`：悬停时青色图标

---

## 🎨 视觉效果

### 放大/缩小按钮样式
```css
/* 默认状态 */
background: transparent;
color: inherit;

/* 鼠标悬停 */
background: rgba(255, 255, 255, 0.5);
color: #0d9488; /* teal-600 */
transition: all 300ms;
cursor: pointer;
```

### 图标对比
| 状态 | 图标 | 含义 |
|------|------|------|
| 未展开 | `<Maximize2 />` | 📤 放大 |
| 已展开 | `<Minimize2 />` | 📥 缩小 |

---

## 🚀 使用场景

### ✅ 适用场景

1. **查看长 Markdown 文档**
   - 放大后有更多空间查看内容
   - 滚动更流畅

2. **预览大图片**
   - 放大后图片显示更清晰
   - 更接近真实尺寸

3. **审阅 PDF 文件**
   - 更大的 iframe 区域
   - 阅读体验更好

4. **无文件时调整布局**
   - 即使没有上传文件也可以放大/缩小
   - 预览空状态也能调整大小

### 🔄 操作流程

```
1. 用户点击放大按钮 (Maximize2)
   ↓
2. 触发 setIsPreviewExpanded(true)
   ↓
3. 布局动画变化 (300ms 过渡)
   ├─ 右上方区域高度: 280px → 120px
   ├─ 提示词输入框: 正常 → 紧凑
   ├─ 开始解析按钮: 显示 → 隐藏
   └─ 预览框: 自适应 → 放大
   ↓
4. 按钮图标变化: Maximize2 → Minimize2
   ↓
5. 用户点击缩小按钮 (Minimize2)
   ↓
6. 触发 setIsPreviewExpanded(false)
   ↓
7. 布局恢复原状 (300ms 过渡)
```

---

## 📊 高度计算对比

### 完整布局高度分析

```
总高度: calc(100vh - 120px)  // 视口高度减去顶部导航和边距

┌─ 正常模式 ─────────────────────────────┐
│ 右上方区域: 280px                      │
│ ├─ 提示词输入框: ~220px                │
│ │  ├─ Label: 28px                      │
│ │  ├─ Textarea: ~160px                 │
│ │  └─ Padding: ~32px                   │
│ └─ 开始解析按钮: 44px (含 margin)       │
├─ 间距: 16px (gap-4)                    │
└─ 文件预览框: calc(100% - 296px)        │
  └─ 约 60-70% 的可视空间                │
└───────────────────────────────────────┘

┌─ 放大模式 ─────────────────────────────┐
│ 右上方区域: 120px (缩小 160px)         │
│ ├─ 提示词输入框: ~120px (紧凑)         │
│ │  ├─ Label: 28px                      │
│ │  ├─ Textarea: ~60px                  │
│ │  └─ Padding: ~32px                   │
│ └─ 开始解析按钮: 隐藏 (节省 44px)       │
├─ 间距: 16px (gap-4)                    │
└─ 文件预览框: calc(100% - 136px)        │
  └─ 约 85-90% 的可视空间 ⬆️ 增加约 25%  │
└───────────────────────────────────────┘
```

**空间增益**：放大后预览区域增加约 **160px** 高度！

---

## 🎯 关���代码位置

| 文件 | 修改内容 | 行数 |
|------|---------|------|
| `/App.tsx` | 添加 `isPreviewExpanded` 状态 | ~37 |
| `/App.tsx` | 动态调整右上方区域高度 | ~192-196 |
| `/App.tsx` | 传递 `isExpanded` 和 `onToggleExpand` | ~213-216 |
| `/components/PromptInput.tsx` | 添加 `isCompact` 属性 | ~6-12 |
| `/components/PromptInput.tsx` | 紧凑模式下隐藏按钮 | ~38-56 |
| `/components/FilePreview.tsx` | 添加放大/缩小按钮 | ~35-47, 60-70 |

---

## ⚡ 性能优化

### CSS 过渡动画
```css
transition-all duration-300
```
- 使用 GPU 加速的 `transition-all`
- 300ms 的过渡时间，流畅自然
- 不会阻塞主线程

### 条件渲染
```tsx
{!isCompact && <Button>开始解析</Button>}
```
- 紧凑模式下完全移除 DOM 节点
- 避免隐藏元素占用内存

---

## 🧪 测试建议

### 功能测试

✅ **无文件时**
- [ ] 点击放大按钮，预览框放大
- [ ] 点击缩小按钮，预览框恢复
- [ ] 空状态提示居中显示

✅ **有文件时**
- [ ] 选择 Markdown 文件，内容正常显示
- [ ] 放大后文字排版不变形
- [ ] 图片在放大后显示更大

✅ **动画效果**
- [ ] 高度变化平滑过渡（300ms）
- [ ] 按钮图标切换自然
- [ ] 无闪烁或跳跃

✅ **交互测试**
- [ ] 鼠标悬停按钮有颜色变化
- [ ] 按钮点击响应灵敏
- [ ] Tooltip 提示正确显示

---

## 🎉 总结

### 新增内容
- ✅ 右侧预览框右上角添加放大/缩小按钮
- ✅ 放大后上方区域高度从 280px 缩小到 120px
- ✅ 提示词输入框支持紧凑模式
- ✅ 放大模式下隐藏"开始解析"按钮
- ✅ 无论是否上传文件都可以调整大小
- ✅ 平滑的过渡动画（300ms）
- ✅ 鼠标悬停效果（背景+颜色变化）

### 用户体验提升
- 📈 预览区域空间增加约 **25%**
- 🎨 更优雅的动画过渡效果
- 🖱️ 更直观的交互反馈
- 📱 适配各种屏幕尺寸

---

**现在用户可以根据需要自由调整预览框大小，享受更灵活的查看体验！** 🚀
